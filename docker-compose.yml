version: '3.0'
services:
  core:
    image: lambdaville.azurecr.io/oneseismic-core:${VERSION:-latest}
    build:
      context: .
      dockerfile: core/Dockerfile
    environment:
      - AZ_BLOB_ACCOUNT
      - AZ_BLOB_KEY
    restart: unless-stopped

  api:
    depends_on:
      - core
    image: lambdaville.azurecr.io/api:${VERSION:-latest}
    build:
      context: .
      dockerfile: api/Dockerfile
      args:
        - VERSION
    ports:
      - '8080:8080'
    environment:
      - HTTP_ONLY=true
      - HOST_ADDR=0.0.0.0:8080
      - STITCH_GRPC_ADDR=core:50051
      - NO_AUTH=true
      - MANIFEST_PATH=/tmp/manifest
      - LOCAL_SURFACE_PATH=/tmp/fixtures/surfaces
