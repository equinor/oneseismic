version: '3.0'
services:
  auth:
    image: lambdaville/no-factor-auth:v0.0.5
    # ports:
    #   - '8089:8089'

  api:
    build:
      context: .
      dockerfile: api/Dockerfile
    depends_on:
      - auth
    environment:
      - API_SECRET="12345678"
      - HTTP_ONLY=true
      - HOST_ADDR=0.0.0.0:8080
      - STITCH_GRPC_ADDR=some.address
      - AUTHSERVER=http://auth:8089/common
      - ISSUER=auth:8089
      - AZURE_STORAGE_URL=http://az:10000/%s/%s
      - AZURE_STORAGE_ACCOUNT=devstoreaccount1
      - AZURE_STORAGE_ACCESS_KEY=Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==
      - AZURE_MANIFEST_CONTAINER=exists
    volumes:
      - fixture_vol:/tmp/fixtures

  test:
    build:
      context: tests/integration
    depends_on:
      - api
    environment:
      - SC_API_HOST_ADDR=http://api:8080
      - AUTH_ADDR=http://auth:8089/common
