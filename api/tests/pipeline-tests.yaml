steps:
- script: |
    go test -v -coverprofile=coverage.txt -covermode count 2>&1 ./... | go-junit-report > report.xml
    gocov convert coverage.txt > coverage.json
    gocov-xml < coverage.json > coverage.xml
    mkdir -p coverage
    gocov-html < coverage.json > coverage/index.html
  condition: always()
  workingDirectory: api
  displayName: 'SC-API create coverage report'
  failOnStderr: true

- script: |
    pytest -v integration.py
  condition: always()
  workingDirectory: api/tests
  displayName: 'SC-API integration tests'
